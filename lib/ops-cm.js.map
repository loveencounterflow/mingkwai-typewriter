{
  "version": 3,
  "file": "ops-cm.js",
  "sourceRoot": "..",
  "sources": [
    "src/ops-cm.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'æ˜Žå¿«æ‰“å­—æœº/OPS-CM'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\n#...........................................................................................................\nPD                        = require 'pipedreams'\n\n\n#-----------------------------------------------------------------------------------------------------------\n@_cm_as_pos = ( x ) -> { line: x.line, ch: x.ch, } ### Unify position-like objects ###\n\n#-----------------------------------------------------------------------------------------------------------\n@_cm_order_positions  = ( positions ) -> positions.sort ( a, b ) ->\n  return -1 if a.line < b.line\n  return +1 if a.line > b.line\n  return -1 if a.ch   < b.ch\n  return +1 if a.ch   > b.ch\n  return  0\n\n#-----------------------------------------------------------------------------------------------------------\n@_cm_fromto_from_range = ( range ) ->\n  ### Given a `range` with `anchor` and `head` properties (which must both be positions, i.e.\n  `{ line, ch, }` objects), return a `{ from, to, }` object where `from` comes always before or coincides\n  with `to` in the document. This is needed to convert an object returned e.g. as selection to an\n  argument that can be used by `markText()`. ###\n  [ p, q, ] = @_cm_order_positions [ ( @_cm_as_pos range.anchor ), ( @_cm_as_pos range.head ), ]\n  return { from: p, to: q, }\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@cm_select_all                    = -> CodeMirror.commands.selectAll        S.codemirror.editor\n@cm_select_only_first             = -> CodeMirror.commands.singleSelection  S.codemirror.editor\n@cm_get_selections                = -> S.codemirror.editor.doc.listSelections()\n@cm_get_selection_texts           = -> S.codemirror.editor.doc.getSelections()\n@cm_get_selections_as_fromtos     = -> ( @_cm_fromto_from_range s for s in @cm_get_selections() )\n# #-----------------------------------------------------------------------------------------------------------\n# @cm_select_only_in_single_line = ->\n\n#-----------------------------------------------------------------------------------------------------------\n@cm_set_mark = ( fromto, clasz ) ->\n  @log 'Âµ52981', \"@cm_set_mark #{rpr fromto}, #{rpr clasz}\"\n  settings =\n    className:      clasz\n    inclusiveLeft:  true\n    inclusiveRight: true\n  return S.codemirror.editor.markText fromto.from, fromto.to, settings\n\n#-----------------------------------------------------------------------------------------------------------\n# @cm_clear_translation_mark = ->\n#   return 0 unless S.translation_mark?\n#   S.translation_mark.clear()\n#   S.translation_mark = null\n#   return 1\n\n#-----------------------------------------------------------------------------------------------------------\n@cm_get_marks_in_range        = ( fromto    ) -> S.codemirror.editor.findMarks fromto.from, fromto.to\n@cm_get_mark_fromtos_in_range = ( fromto    ) -> ( ( @_cm_as_pos t.find() ) for t in @cm_get_marks_in_position fromto )\n@cm_get_marks_in_position     = ( position  ) -> S.codemirror.editor.findMarksAt position\n@cm_get_cursor                =               -> @_cm_as_pos S.codemirror.editor.getCursor 'head'\n@cm_set_cursor                = ( position  ) -> S.codemirror.editor.setCursor position ### TAINT might want to use options ###\n@cm_get_text                  = ( fromto    ) -> S.codemirror.editor.getRange fromto.from, fromto.to\n@cm_text_from_mark            = ( mark      ) -> @cm_get_text mark.find()\n@cm_text_from_line_idx        = ( line_idx  ) -> S.codemirror.editor.getLine line_idx\n@cm_replace_selection         = ( text      ) -> S.codemirror.editor.doc.replaceSelection text\n@cm_range_is_point            = ( fromto    ) -> CND.equals fromto.from, fromto.to\n\n#-----------------------------------------------------------------------------------------------------------\n@cm_select = ( fromto ) ->\n  @log 'Âµ53082', \"cm_select: #{rpr fromto}\"\n  return S.codemirror.editor.setSelection fromto.from, fromto.to\n\n#-----------------------------------------------------------------------------------------------------------\n@position_and_clasz_from_mark = ( mark ) ->\n  fromto = mark.find()\n  return { from: ( @_cm_as_pos fromto.from ), to: ( @_cm_as_pos fromto.to ), clasz: ( mark.className ? '' ), }\n\n\n#===========================================================================================================\n# SET TSRs, TRANSCRIPTORS\n#-----------------------------------------------------------------------------------------------------------\n@format_tsr_marks = ( d ) ->\n  # S.codemirror.editor.getSearchCursor /ðŸ›¸(?<tsnr>[0-9]+):(?<text>[.*?])$/, start, options)\n  pattern = /ðŸ›¸(?<tsnr>[0-9]+):/\n  finds   = []\n  cursor  = S.codemirror.editor.getSearchCursor pattern\n  # @log 'Âµ11121', rpr ( key for key of cursor )\n  #.........................................................................................................\n  while cursor.findNext()\n    from      = cursor.from()\n    to        = cursor.to()\n    fromto    = { from, to, }\n    text      = @cm_get_text fromto\n    { tsnr, } = ( text.match pattern ).groups\n    tsnr      = parseInt tsnr, 10\n    finds.push { fromto, tsnr, }\n  #.........................................................................................................\n  for { fromto, tsnr, } in finds\n    # /ðŸ›¸(?<tsnr>[0-9]+):(?<text>[.*?])$/\n    @log \"Âµ46674\", \"found TSR mark at #{rpr fromto}: #{rpr text} (TS ##{tsnr})\"\n    @cm_format_as_tsr_mark fromto, tsnr\n  #.........................................................................................................\n  return null\n  # for line_idx in [ S.codemirror.editor.firstLine() .. S.codemirror.editor.lastLine() ]\n  #   text =\n\n#-----------------------------------------------------------------------------------------------------------\n@cm_format_as_tsr_mark = ( fromto, tsnr ) ->\n  ### TAINT use own API ###\n  settings      =\n    className:        \"tsr tsr#{tsnr}\"\n    atomic:           true\n    inclusiveLeft:    false\n    inclusiveRight:   false\n  S.codemirror.editor.markText fromto.from, fromto.to, settings\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@cm_insert_tsr_mark = ( fromto, tsnr ) ->\n  ### TAINT use own API ###\n  ###\n  /\\U{1d400}..1d7ff/u\n  ###\n  # for cid in [ 0 .. 32 ]\n  #   tsr_mark_left += \"#{cid}|\" + ( String.fromCodePoint cid ) + \"|\"\n  ### \\x00 (zero byte), \\x0c == \\f (form feed) are displayed with zero width ###\n  # tsr_mark_left = \"\\fð——ð”¨\"\n  # tsr_mark_left = \"\\x00ð——ð”¨\"\n  # tsr_mark_left = \"\\ue01bð——ð”¨\"\n  tsr_mark_left = \"\\u{f11c}#{tsnr}\\u{f005}\"\n  # tsr_mark_left = \"\\\\ð——ðŸ›¸#{tsnr}:\"\n  clasz         = \"tsr tsr#{tsnr}\"\n  fromto_right  = { line: fromto.from.line, ch: ( fromto.from.ch + tsr_mark_left.length ), }\n  settings      =\n    className:        clasz\n    atomic:           true\n    inclusiveLeft:    false\n    inclusiveRight:   false\n  ### TAINT use own API ###\n  S.codemirror.editor.replaceRange tsr_mark_left, fromto.from\n  S.codemirror.editor.markText fromto.from, fromto_right, settings\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@cm_set_tsrs = ( tsnr ) ->\n  ### Bound to `ctrl+0` ... `ctrl+4` ###\n  action  = if tsnr is 0 then 'clear' else 'set'\n  if action is 'clear'\n    @log 'Âµ48733-1', \"clear TSR not implemented\"\n    return null\n  delta   = if action is 'clear' then -1 else +1\n  clasz   = \"tsr tsr#{tsnr}\"\n  for fromto in @cm_get_selections_as_fromtos()\n    unless @cm_range_is_point fromto\n      @log 'Âµ48733-2', \"non-point ranges not implemented\"\n      return null\n    @log 'Âµ48733-4', rpr fromto\n    ### TAINT allow to configure appearance of TSR mark ###\n    # tsr_mark_left = \"[#{S.transcriptors[ tsnr ].display_name}:\"\n    @cm_insert_tsr_mark fromto, tsnr\n  @emit_transcribe_event()\n  return null\n\n\n#===========================================================================================================\n# DIAGNOSTICS\n#-----------------------------------------------------------------------------------------------------------\n@cm_mark_tsrs = ->\n  ### Currently only used for diagnostics, will toggle CSS class `hilite` on all TSRs the selection is\n  touching when `ctrl+m` is hit ###\n  ### TAINT code duplication ###\n  for fromto in @cm_get_selections_as_fromtos()\n    if CND.equals fromto.from, fromto.to then marks = @cm_get_marks_in_position  fromto.from\n    else                                      marks = @cm_get_marks_in_range     fromto\n    if marks.length is 0\n      @log 'Âµ53688', \"didn't find any marks at #{rpr fromto}\"\n    else\n      for mark in marks\n        @log 'Âµ53789', \"found existing mark: #{rpr @position_and_clasz_from_mark mark}\"\n        { from, to, clasz, } = @position_and_clasz_from_mark mark\n        mark.clear()\n        clasz = if ( clasz.match /\\bhilite\\b/ )? then clasz.replace /\\s*hilite\\s*/g, ' ' else clasz + ' hilite'\n        @cm_set_mark { from, to, }, clasz\n  return null\n\n\n\n"
  ]
}