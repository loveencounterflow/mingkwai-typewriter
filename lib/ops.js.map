{
  "version": 3,
  "file": "ops.js",
  "sourceRoot": "..",
  "sources": [
    "src/ops.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n### TAINTs\n\n* separate:\n\n  * `focus` (a mechanism used by the browser)\n\n  * ?`select`, `choose`? for the action of selecting one particular candidate\n\n  * ??? for what is called `focusframe` now\n\n  these are three different things and should be called different names.\n\n* accordingly, rename `focusframe` and those `*_focus*` methods that refer to it instead of to browser focus\n\n* use module-global `S`: this code will only ever run a single input instance; where it does use modules\n  that potentially serve several independent consumers, `S` will not be used as argument anyway\n\n* refactor code into (local) modules\n\n###\n\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = '明快打字机/OPS'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\ninspect                   = ( require 'util' ).inspect\n# TRAP                      = require 'mousetrap'\nKEYS                      = require '../lib/keys'\nT                         = require '../lib/templates'\nPATH                      = require 'path'\nFS                        = require 'fs'\n#...........................................................................................................\nrequire                   '../lib/exception-handler'\n# require                   '../lib/kana-input'\n# require                   '../lib/kanji-input'\n#...........................................................................................................\nPD                        = require 'pipedreams'\n{ jr, }                   = CND\n{ after, }                = CND.suspend\ndefer                     = setImmediate\n{ $\n  $async }                = PD\n# XE                        = null\nXE                        = require '../lib/xemitter'\n{ inspect, }              = require 'util'\nxrpr                      = ( x ) -> inspect x, { colors: yes, breakLength: Infinity, maxArrayLength: Infinity, depth: Infinity, }\n#...........................................................................................................\nS                         = require '../lib/settings' ### module-global configuration and editor state object ###\nglobal.S                  = S\n\n#-----------------------------------------------------------------------------------------------------------\nXE.listen_to_all ( key, d ) ->\n  # whisper 'µ99823', key #, jr d\n  v       = d.value ? {}\n  logger  = jQuery '#logger'\n  ( logger.find ':first-child').remove() while logger.children().length > 10\n  message = rpr v\n  # message = ( k for k         of d.value                ).join ', '\n  # message = switch key\n  #   when '^kblevel' then  ( k for k, toggle of S.kblevels when toggle ).join ', '\n  #   else                  ( k for k         of d.value                ).join ', '\n  #.........................................................................................................\n  logger.append ( \"<div>#{Date.now()}: #{rpr key}: #{message}</div>\" )\n  console.log 'µ33499', Date.now(), key, d\n  # if ( kblevels = d.value?.S?.kblevels )\n  #   logger.append ( \"<div>#{Date.now()}: kblevels: #{rpr kblevels}</div>\" )\n  logger.scrollTop logger[ 0 ].scrollHeight\n  #.........................................................................................................\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@log = ( text ) ->\n  ### TAINT code duplication ###\n  logger = jQuery '#logger'\n  ( logger.find ':first-child').remove() while logger.children().length > 10\n  ### TAINT should escape text (or accept HTML?) ###\n  logger.append ( \"<div>#{Date.now()}: #{text}</div>\" )\n  console.log 'µ33499', Date.now(), text\n  logger.scrollTop logger[ 0 ].scrollHeight\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nXE.listen_to '^candidates', @, ( d ) ->\n  @focusframe_to_candidates() unless S.focus_is_candidates\n  v       = d.value\n  rows    = ( ( T.get_flexgrid_html ( idx + 1 ), glyph ) for glyph, idx in v.candidates ).join '\\n'\n  ( jQuery '#candidates-flexgrid div' ).remove()\n  ( jQuery '#candidates-flexgrid'     ).append rows\n  #.........................................................................................................\n  ### TAINT code duplication ###\n  glyphboxes = jQuery '#candidates-flexgrid div.glyph'\n  glyphboxes.on 'click', ( e ) =>\n    me = jQuery e.target\n    ### TAINT code duplication ###\n    ### TAINT use API to move selection ###\n    glyphboxes.removeClass  'cdtsel'\n    me.addClass             'cdtsel'\n    @log \"µ33983-1 #{me.text()} #{jr me.offset()}\"\n  #.........................................................................................................\n  @index_candidates()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@index_candidates = ->\n  ### Add or update each candidate `<div class=glyph> with attributes indicating its left- and right-based\n  column and row numbers, starting from 1. Elements that match `jQuery '[lrow=1]'` are in the first row from\n  the top, while those that match `jQuery '[rrow=1]'` are in the last row from top (first row from the\n  bottom). Likewise, `lcol=1`, `rcol=1` match the leftmost and rightmost elements. These indexes have to be\n  re-calculated after each container resize event, but simplify the code needed to select single and groups\n  of elements. The beauty of the scheme is that we can select e.g. all leftmost elements or all elements\n  in the first row (should the need ever arise). ###\n  ### TAINT code duplication ###\n  glyphboxes      = jQuery '#candidates-flexgrid div.glyph'\n  lcol            = 0\n  lrow            = 0\n  prv_top         = null\n  candidate_count = glyphboxes.length\n  lnr             = 0\n  rnr             = candidate_count + 1\n  rows            = []\n  row             = null\n  #.........................................................................................................\n  @log \"index_candidates() (#{candidate_count})\"\n  #.........................................................................................................\n  for idx in [ 0 ... candidate_count ]\n    glyphbox = glyphboxes.eq idx\n    #.......................................................................................................\n    if ( nxt_top = glyphbox.offset().top ) isnt prv_top\n      if row?\n        rows.push row\n        col_count = row.length\n        for sub_glyphbox, col_idx in row\n          sub_glyphbox.attr 'rcol', col_count - col_idx\n      #.....................................................................................................\n      row = []\n      prv_top = nxt_top\n      lcol    = 0\n      lrow   += +1\n    #.......................................................................................................\n    row.push glyphbox\n    lnr      += +1\n    rnr      += -1\n    lcol     += +1\n    #.......................................................................................................\n    glyphbox.attr 'lnr',  lnr\n    glyphbox.attr 'rnr',  rnr\n    glyphbox.attr 'lcol', lcol\n    glyphbox.attr 'lrow', lrow\n  #.........................................................................................................\n  rows.push row if row?\n  row_count = rows.length\n  for row, row_idx in rows\n    for glyphbox in row\n      glyphbox.attr 'rrow', row_count - row_idx\n  #.........................................................................................................\n  rows.length = 0 ### not strictly needed, just to make de-allocation explicit ###\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@insert_space_or_selection = ->\n  ### TAINT this implementation precludes any other functionality that the space bar might be associated\n  with in CodeMirror ###\n  cdtsel = jQuery '.cdtsel'\n  ### TAINT honour multiple selection ###\n  text   = if cdtsel.length > 0 then cdtsel.text() else ' '\n  S.codemirror.editor.replaceSelection text\n  @focusframe_to_editor()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@_select_delta_candidate = ( deltas ) ->\n  ### Select next candidate(s) based on `deltas`, which should be an object with one or more of the\n  following members:\n\n  * **`lnr`**:     left-anchored  candidate         number\n  * **`lcol`**:    left-anchored  column            number\n  * **`lrow`**:    left-anchored  row (i.e. line)   number\n  * **`rnr`**:     right-anchored candidate         number\n  * **`rcol`**:    right-anchored column            number\n  * **`rrow`**:    right-anchored row (i.e. line)   number\n\n  Left-anchored values count from the usual (i.e. top or left) end of that dimension, richt-anchored ones\n  from the opposite sides; for example, `lcol: 1` selects the first (leftmost), `rcol: 1` the last\n  (rightmost) entry in each row; `lrow: 1` the first row, `rrow: 1` the last one; in a line with, say, five\n  candidates, `lrow: 4` is equivalent to `rrow: 2`, and `lrow: 5` is the same as `rrow: 1`.\n\n  Each entry may be either a positive or negative integer, or zero, or 'first', or 'last'. A non-zero number\n  indicates the number of steps to go in the respective dimension while zero indicates 'keep this value'.\n  For example, to move right irregardless of line breaks, use `{ lnr: +1, }`. To move to the first entry on\n  the next line, use `{ lcol: 'first', lrow: +1, }`. To go to the last entry of the current row, use `{\n  lrow: 0, lcol: 'last', }` or `{ lrow: 0, rcol: 'first', }`. The selected candidates are the intersection\n  of all sub-selectors.\n\n  This method will have no effect unless there is one or more selected entries to start with. ###\n  #.........................................................................................................\n  R                   = 0\n  prv_cdtsel          = jQuery '.cdtsel'\n  #.........................................................................................................\n  if prv_cdtsel.length is 0\n    @log \"_select_delta_candidate: no candidate selected\"\n    return R\n  #.........................................................................................................\n  ### TAINT code duplication ###\n  glyphboxes    = jQuery '#candidates-flexgrid div.glyph'\n  nxt_selector  = []\n  #.........................................................................................................\n  for delta_key, delta_value of deltas\n    switch type = CND.type_of delta_value\n      when 'text'\n        switch delta_value\n          when 'first'\n            nxt_selector.push \"[#{delta_key}=1]\"\n          when 'last'\n            delta_key = delta_key.replace /^[rl]/, ( $0 ) -> if $0 is 'l' then 'r' else 'l'\n            nxt_selector.push \"[#{delta_key}=1]\"\n          else throw new Error \"µ37634 unknown move command #{rpr delta_value}\"\n      when 'number'\n        prv_value = parseInt ( prv_cdtsel.attr delta_key ),  10\n        nxt_value = prv_value + delta_value\n        nxt_selector.push \"[#{delta_key}=#{nxt_value}]\"\n      else throw new Error \"µ37633 expected a text or a number, got a #{type}\"\n  nxt_selector = nxt_selector.join ''\n  @log \"_select_delta_candidate #{jr deltas} #{jr nxt_selector}\"\n  return R if ( R = ( nxt_cdtsel = glyphboxes.filter nxt_selector ).length ) is 0\n  prv_cdtsel.removeClass  'cdtsel'\n  nxt_cdtsel.addClass     'cdtsel'\n  nxt_cdtsel[ 0 ].scrollIntoViewIfNeeded()\n  return R\n\n#-----------------------------------------------------------------------------------------------------------\nXE.listen_to '^load-documents', @, ( d ) ->\n  ### Will be used to restore previous state, open new documents; for now, just opens the default file. ###\n  ### TAINT auto-create file when not present ###\n  file_path = PATH.resolve PATH.join __dirname, '../.cache/default.md'\n  S.codemirror.editor.doc.setValue FS.readFileSync file_path, { encoding: 'utf-8', }\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n### TAINT use proper keybinding API to define key bindings ###\nXE.listen_to '^keyboard', @, ( d ) ->\n  if d.value.name is 'ctrl+s'\n    XE.emit PD.new_event '^save-document'\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nXE.listen_to '^save-document', @, ( d ) ->\n  ### Will be used to save active document; currently just saves default file. ###\n  file_path = PATH.resolve PATH.join __dirname, '../.cache/default.md'\n  @log \"saving document to #{rpr file_path}\"\n  FS.writeFileSync file_path, S.codemirror.editor.doc.getValue()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@focusframe_to_editor = ->\n  @_focusframe_to 'leftbar'\n  ### TAINT use method, must be possible to remap ###\n  S.focus_is_candidates = false\n  # S.kblevels.shift      = false\n@focusframe_to_candidates = ->\n  @_focusframe_to 'rightbar'\n  ### TAINT use method, must be possible to remap ###\n  S.focus_is_candidates = true\n  # S.kblevels.shift      = false\n@focusframe_to_logger = ->\n  @_focusframe_to '#logger'\n  ### TAINT use method, must be possible to remap ###\n  S.focus_is_candidates = false\n  # S.kblevels.shift      = false\n\n#-----------------------------------------------------------------------------------------------------------\n@_focusframe_to = ( target ) ->\n  # target      = jQuery( document.activeElement )\n  target      = jQuery target if CND.isa_text target\n  ff          = jQuery 'focusframe'\n  return if target.length < 1\n  # ff.offset     target.offset()\n  # ff.width      target.width()\n  # ff.height     target.height()\n  tgto        = target.offset()\n  return unless tgto?\n  left    = tgto.left       - 1\n  top     = tgto.top        - 1\n  width   = target.width()  + 2\n  height  = target.height() + 2\n  ff.animate { left, top, width, height, }, 100\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@always_focus_editor = ->\n  @always_focus_editor = -> ### do not add any more handlers with this method after first call ###\n  ( jQuery 'div.CodeMirror-code' ).on 'blur', -> @focus()\n  ( jQuery 'div.CodeMirror-code' ).focus()\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@_cm_keymap_move = ( cm, editor_method_name, candidates_method ) ->\n  try\n    return CodeMirror.commands[ editor_method_name ] cm unless S.focus_is_candidates\n    return candidates_method.apply @\n  catch error\n    alert \"when trying to call `CodeMirror.commands.#{editor_method_name}`, an error was thrown\"\n    throw error\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n### TAINT the defaults for cursor moves are taken from\n* public/codemirror/src/edit/commands.js\n* public/codemirror/keymap/sublime.js\nit would be advantageous to derive them somehow from the source or the running instance\n###\n@move_right         = ( cm ) -> @_cm_keymap_move cm, 'goCharRight', => @_select_delta_candidate { lnr: +1, }\n@move_left          = ( cm ) -> @_cm_keymap_move cm, 'goCharLeft',  => @_select_delta_candidate { lnr: -1, }\n@move_nxtline_first = ( cm ) -> @_cm_keymap_move cm, 'defaultTab',  => @_select_delta_candidate { lcol: 'first', lrow: +1, }\n@move_prvline_first = ( cm ) -> @_cm_keymap_move cm, 'indentLess',  => @_select_delta_candidate { lcol: 'first', lrow: -1, }\n@move_up            = ( cm ) -> @_cm_keymap_move cm, 'goLineUp',    => @log '######### move_up'\n@move_down          = ( cm ) -> @_cm_keymap_move cm, 'goLineDown',  => @log '######### move_down'\n@move_to_home       = ( cm ) -> @_cm_keymap_move cm, 'goLineStartSmart', => @_select_delta_candidate { lrow: 0, lcol: 'first', }\n@move_to_end        = ( cm ) -> @_cm_keymap_move cm, 'goLineEnd',  => @_select_delta_candidate { lrow: 0, lcol: 'last',  }\n\n#-----------------------------------------------------------------------------------------------------------\n@set_translation_mode = ( xxx ) ->\n\n\nKEYS.bind 'ctrl+k',    -> @log \"ctrl+k\"\nKEYS.bind 'ctrl+l', @, -> @log \"ctrl+l\"\n\n#-----------------------------------------------------------------------------------------------------------\n### TAINT use proper keybinding API to define key bindings ###\nXE.listen_to '^kblevel', @, ( d ) ->\n  ### map kblevel 'shift' to manual editor/candidates focus selection ###\n  v       = d.value\n  # debug 'µ87444', S.kblevels.shift\n  if ( S.focus_is_candidates = S.kblevels.shift ) then  @focusframe_to_candidates()\n  else                                                  @focusframe_to_editor()\n  ### TAINT consider to re-set focus after mouse clicks to elsewhere in GUI ###\n  ### Make browser focus always stay on editor: ###\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@set_translation_mark = ( position_from, position_to ) ->\n  settings =\n    className:      'txtmark_xxx'\n    inclusiveLeft:  false\n    inclusiveRight: true\n  return S.codemirror.editor.markText position_from, position_to, settings\n\n#-----------------------------------------------------------------------------------------------------------\n@init_cm_keymap = ->\n  mktw_keymap =\n    'Left':       ( cm  ) => @move_left                 cm\n    'Right':      ( cm  ) => @move_right                cm\n    'Up':         ( cm  ) => @move_up                   cm\n    'Down':       ( cm  ) => @move_down                 cm\n    'Tab':        ( cm  ) => @move_nxtline_first        cm\n    'Shift-Tab':  ( cm  ) => @move_prvline_first        cm\n    'Home':       ( cm  ) => @move_to_home              cm\n    'End':        ( cm  ) => @move_to_end               cm\n    'Space':      ( cm  ) => @insert_space_or_selection cm\n  #.........................................................................................................\n  S.codemirror.editor.addKeyMap mktw_keymap\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\nXE.listen_to '^raw-input', ( d ) ->\n  ### Transform `^raw-input` to `^input` events ###\n  #.........................................................................................................\n  { change, }     = d.value\n  { editor, }     = S.codemirror\n  { doc, }        = editor\n  cursor          = doc.getCursor()\n  #.........................................................................................................\n  ### TAINT kludge to collapse multiple selections into a single one ###\n  CodeMirror.commands.singleSelection editor\n  #.........................................................................................................\n  line_idx        = cursor.line\n  line_handle     = doc.getLineHandle line_idx\n  line_info       = doc.lineInfo line_handle ### TAINT consider to use line_idx, forego line_handle ###\n  { text, }       = line_info\n  #.........................................................................................................\n  XE.emit PD.new_event '^input', { change, line_idx, text, }\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@init = ->\n  # { remote, }               = require 'electron'\n  # XE                        = remote.require './xemitter'\n  #.........................................................................................................\n  S.candidates          =\n    jq:           jQuery '#candidates'\n    selected:\n      id:         null\n  S.focus_is_candidates = false\n  #.........................................................................................................\n  ### Initialize CodeMirror ###\n  S.codemirror.editor = CodeMirror.fromTextArea ( jQuery '#codemirror' )[ 0 ], S.codemirror.settings\n  S.codemirror.editor.setSize null, '100%'\n  S.codemirror.editor.on 'inputRead', ( me, change ) -> XE.emit PD.new_event '^raw-input', { change, }\n  XE.listen_to '^ignore-delete', -> S.ignore_delete += +1\n  S.codemirror.editor.on 'change', ( me, change ) ->\n    ### TAINT when inserting results, will there be a change event? ###\n    return null unless change.origin is '+delete'\n    ### ignore event if it has been generated: ###\n    if S.ignore_delete > 0\n      S.ignore_delete += -1\n      return null\n    XE.emit PD.new_event '^raw-input', { change, }\n  @always_focus_editor()\n  #.........................................................................................................\n  # S.codemirror.editor.on 'beforeChange',    ( me, change      ) -> whisper 'µ66653', 'beforeChange',  jr change\n  # S.codemirror.editor.on 'change',          ( me, change      ) -> whisper 'µ66653', 'change',        jr change\n  # S.codemirror.editor.on 'changes',         ( me, changes     ) -> whisper 'µ66653', 'changes',       jr changes\n  # S.codemirror.editor.on 'cursorActivity',  ( me              ) -> whisper 'µ66653', 'cursorActivity'\n  # S.codemirror.editor.on 'keyHandled',      ( me, name, event ) -> whisper 'µ66653', 'keyHandled',    jr name\n  # S.codemirror.editor.on 'inputRead',       ( me, change      ) -> whisper 'µ66653', 'inputRead',     jr change\n  #.........................................................................................................\n  ### Register key and mouse events ###\n  KEYS.generate_keboard_events jQuery 'html'\n  # KEYS.register 'axis', 'vertical',     ( uie )   => @on_vertical_navigation  uie\n  # KEYS.register 'slot', 'Enter',        ( uie )   => @on_add_selection        uie\n  XE.emit PD.new_event '^load-documents'\n  @focusframe_to_editor()\n  @init_cm_keymap()\n  #.........................................................................................................\n  ### Detect resizing events: ###\n  ### TAINT won't work when panes are shifted (probably) ###\n  ( jQuery window ).on 'resize', =>\n    debug \"resize window\"\n    @index_candidates()\n    return null\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\njQuery init.bind @\n\n\n###\ncm.findPosH(start: {line, ch}, amount: integer, unit: string, visually: boolean) → {line, ch, ?hitSide: boolean}\ncm.findPosV(start: {line, ch}, amount: integer, unit: string) → {line, ch, ?hitSide: boolean}\ncm.findWordAt(pos: {line, ch}) → {anchor: {line, ch}, head: {line, ch}}\ncm.hasFocus() → boolean\n\ndoc.addSelection        = (anchor: {line, ch}, ?head: {line, ch})\ndoc.changeGeneration    = (?closeEvent: boolean) → integer\ndoc.eachLine            = (f: (line: LineHandle))\ndoc.eachLine            = (start: integer, end: integer, f: (line: LineHandle))\ndoc.extendSelection     = (from: {line, ch}, ?to: {line, ch}, ?options: object)\ndoc.extendSelections    = (heads: array<{line, ch}>, ?options: object)\ndoc.extendSelectionsBy  = (f: function(range: {anchor, head}) → {line, ch}), ?options: object)\ndoc.firstLine           = () → integer\ndoc.getCursor           = (?start: string) → {line, ch}\ndoc.getExtending        = () → boolean\ndoc.getLine             = (n: integer) → string\ndoc.getLineHandle       = (num: integer) → LineHandle\ndoc.getLineNumber       = (handle: LineHandle) → integer\ndoc.getRange            = (from: {line, ch}, to: {line, ch}, ?separator: string) → string\ndoc.getSelection        = (?lineSep: string) → string\ndoc.getSelections       = (?lineSep: string) → array<string>\ndoc.getValue            = (?separator: string) → string\ndoc.isClean             = (?generation: integer) → boolean\ndoc.lastLine            = () → integer\ndoc.lineCount           = () → integer\ndoc.listSelections      = () → array<{anchor, head}>\ndoc.markClean           = ()\ndoc.replaceRange        = (replacement: string, from: {line, ch}, to: {line, ch}, ?origin: string)\ndoc.replaceSelection    = (replacement: string, ?select: string)\ndoc.replaceSelections   = (replacements: array<string>, ?select: string)\ndoc.setCursor           = (pos: {line, ch}|number, ?ch: number, ?options: object)\ndoc.setExtending        = (value: boolean)\ndoc.setSelection        = (anchor: {line, ch}, ?head: {line, ch}, ?options: object)\ndoc.setSelections       = (ranges: array<{anchor, head}>, ?primary: integer, ?options: object)\ndoc.setValue            = (content: string)\ndoc.somethingSelected   = () → boolean\n###\n\n\n\n\n"
  ]
}