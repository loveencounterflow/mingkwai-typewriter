{
  "version": 3,
  "file": "app.js",
  "sourceRoot": "..",
  "sources": [
    "src/app.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = '明快打字机/APP'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\nPATH                      = require 'path'\nFS                        = require 'fs'\nURL                       = require 'url'\ninspect                   = ( require 'util' ).inspect\nlog                       = ( P... ) -> process.stdout.write ( rpr P ) + '\\n'\n# { app, globalShortcut, }  = require 'electron'\nwindow                    = null\n# log Object.keys require 'electron'\n{ app, BrowserWindow }    = require 'electron'\nTEMPLATES                 = require './templates'\nPD                        = require 'pipedreams'\nXE                        = require './xemitter'\nIF                        = require 'interflug'\n{ jr, }                   = CND\n#...........................................................................................................\nkb_listener_is_ready      = false\napp_is_ready              = false\npage_html_path            = PATH.resolve PATH.join __dirname, '../public/main.html'\n### keep a module-global reference to main window to prevent GC from collecting it as per\nhttps://youtu.be/iVdXOrtdHvA?t=713 ###\nmain_window               = null\n\n#-----------------------------------------------------------------------------------------------------------\n@write_page_source = ->\n  ### Write out the HTML of the main page; this is strictly only needed when template has changed, which we\n  maybe should detect in the future: ###\n  page_source = TEMPLATES.main_2()\n  # page_source = TEMPLATES.minimal()\n  FS.writeFileSync page_html_path, page_source\n  help \"updated page source written to #{rpr PATH.relative process.cwd(), page_html_path}\"\n\n#-----------------------------------------------------------------------------------------------------------\n@list_versions = ->\n  ### Log the most important versions to the console: ###\n  keys = [\n    'v8'\n    'node'\n    'electron'\n    'chrome'\n    'icu'\n    'unicode' ]\n  whisper ( key.padEnd 20 ), process.versions[ key ] for key in keys\n  whisper ( '明快打字机'.padEnd 15 ), ( require '../package.json' ).version\n  return null\n\n#-----------------------------------------------------------------------------------------------------------\n@listen_to_keyboard = ->\n  on_ready  = =>\n    urge 'µ88782', \"keyboard event source ready\"\n    kb_listener_is_ready = true\n    @launch() if app_is_ready and kb_listener_is_ready\n  #.........................................................................................................\n  pipeline  = []\n  source    = IF.K.new_keyboard_event_source { on_ready, }\n  pipeline.push source\n  pipeline.push PD.$watch ( d ) -> XE.emit d\n  pipeline.push PD.$drain()\n  PD.pull pipeline...\n\n#-----------------------------------------------------------------------------------------------------------\n@on_app_ready = ->\n  app_is_ready = true\n  @launch() if app_is_ready and kb_listener_is_ready\n\n#-----------------------------------------------------------------------------------------------------------\n@launch = ->\n  debug 'µ11233', 'launch'\n  ### TAINT workaround: obtain configuration from a throw-away state instance ###\n  state       = require './state'\n  S           = state.new()\n  main_window = new BrowserWindow S.window.electron\n  #.........................................................................................................\n  main_window.loadURL URL.format { pathname: page_html_path, protocol: 'file:', slashes: true, }\n  #.........................................................................................................\n  ### TAINT consider to move all exception handlers to module `exception-handler` ###\n  main_window.on 'unresponsive', ->\n    alert \"main_window unresponsive!\"\n  #.........................................................................................................\n  process.on 'uncaughtException',  ( error ) ->\n    alert \"uncaught exception\"\n    alert rpr error\n    process.exit 1\n  #.........................................................................................................\n  main_window.webContents.on 'crashed', ->\n    alert \"main_window crashed!\"\n    main_window.close()\n    return null\n  #.........................................................................................................\n  main_window.once 'ready-to-show', ->\n    # debug '77565-1', 'ready-to-show'\n    main_window.show()\n    main_window.maximize()                 if S.window.maximize      ? no\n    main_window.webContents.openDevTools() if S.window.show_devtools ? no\n    main_window.webContents.on 'error', ( error ) => warn 'µ76599', error.message\n    ### thx to https://stackoverflow.com/a/44012967/7568091 ###\n    pid                 = process.pid\n    wid                 = await IF.wait_for_window_id_from_pid process.pid\n    XE.emit PD.new_event '^window-id', wid\n    return null\n\n\n############################################################################################################\napp.once 'ready', @on_app_ready.bind @\n@write_page_source()\n@list_versions()\n@listen_to_keyboard()\n\n\n"
  ]
}